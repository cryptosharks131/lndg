{% extends "base.html" %}
{% block title %} {{ block.super }} - Peer Events{% endblock %}
{% block content %}
{% load humanize %}
{% if peer_events %}
<div class="w3-container w3-padding-small">
  <h2><a href="/peerevents/">Last 150 Peer Events</a></h2>
  <table id="peerEvents" class="w3-table-all w3-centered w3-hoverable">
    <tr>
      <th>Timestamp</th>
      <th onclick="sortTable(event.target, 1, 'String')">Channel ID</th>
      <th onclick="sortTable(event.target, 2, 'String', 0, 'a')">Peer Alias</th>
      <th onclick="sortTable(event.target, 3, 'String')">Setting</th>
      <th onclick="sortTable(event.target, 4, 'String')">Old Value</th>
      <th onclick="sortTable(event.target, 5, 'String')">New Value</th>
      <th onclick="sortTable(event.target, 6, '%')">Change</th>
      <th onclick="sortTable(event.target, 7, '% | ')" width=12% title="Outbound | Inbound"">Channel Liquidity</th>
    </tr>
    {% for log in peer_events %}
    <tr>
      <td title="{{ log.timestamp }}">{{ log.timestamp|naturaltime }}</td>
      <td><a href="/channel?={{ log.chan_id }}" target="_blank">{{ log.chan_id }}</a></td>
      <td><a href="/peerevents?={{ log.chan_id }}">{% if log.peer_alias == '' %}{{ log.remote_pubkey|slice:":12" }}{% else %}{{ log.peer_alias }}{% endif %}</a></td>
      <td>{{ log.event }}</td>
      <td>{% if log.old_value == "" %}---{% elif log.event == "Connection" %}{% if log.old_value == 1 %}Online{% else %}Offline{% endif %}{% elif log.event == "Disabled" %}{% if log.old_value == 1 %}True{% else %}False{% endif %}{% else %}{{ log.old_value|intcomma }}{% endif %}</td>
      <td {% if log.event == "Disabled" and log.new_value == 0 %}style="background-color: rgba(46,160,67,0.15)"{% elif log.event == "Connection" and log.new_value == 1 %}style="background-color: rgba(46,160,67,0.15)"{% elif log.new_value > log.old_value and log.event != "Disabled" %}style="background-color: rgba(46,160,67,0.15)"{% else %}style="background-color: rgba(248,81,73,0.15);"{% endif %}>{% if log.event == "Connection" %}{% if log.new_value == 1 %}Online{% else %}Offline{% endif %}{% elif log.event == "Disabled" %}{% if log.new_value == 1 %}True{% else %}False{% endif %}{% else %}{{ log.new_value|intcomma }}{% endif %}</td>
      <td {% if log.event == "Connection" or log.event == "Disabled" or log.old_value == "" %}>---{% elif log.new_value > log.old_value %}style="background-color: rgba(46,160,67,0.15)">{{ log.change }}%{% else %}style="background-color: rgba(248,81,73,0.15);">{{ log.change|intcomma }}%{% endif %}</td>
      <td title="Outbound Liquidity: {{ log.out_liq|intcomma }}">{{ log.out_percent }}% | {{ log.in_percent }}%</td>
    </tr>
    {% endfor %}
  </table>
</div>
{% endif %}
{% if not peer_events %}
<div class="w3-container w3-padding-small">
  <center><h1>No peer events to see here yet!</h1></center>
</div>
{% endif %}
{% endblock %}
