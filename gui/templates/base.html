<!DOCTYPE html>
{% load static %}
<html>
  <style>
  </style>
  <script src="{% static 'api.js' %}"></script>
  <script src="{% static 'sort_table.js' %}"></script>
  <script src="{% static 'dark_mode.js' %}"></script>
  <script>const token = "{{ csrf_token }}"</script>
  <head>
    <meta charset="utf-8">
    {% block meta %}{% endblock %}
    <title>{% block title %}LNDg{% endblock %}</title>
    {% load qr_code %}
    <link href="{% static 'w3style.css' %}" rel="stylesheet" type="text/css">
  </head>
  <body onload="applyTheme()">
    <div id="content">
      {% if messages %}
      <div id="messages" class="w3-container w3-padding-small">
        {% for message in messages %}
        <h1 class="w3-orange w3-padding-small" style="word-wrap: break-word;margin-top:15px">{{ message.message }}</h1>
        {% with sliced_msg=message.message|slice:":17" %}
          {% if sliced_msg == "Deposit Address: " or sliced_msg == "Invoice created! " %}
            {% qr_from_text message.message|slice:"17:" size="s" image_format="png" error_correction="L" %}
          {% endif %}
        {% endwith %}
        {% endfor %}
      </div>
      {% endif %}
      <div class="w3-container">
        <h1><a href="/">My Lnd Overview</a></h1>
      </div>
      {% block content %}{% endblock %}
    </div>
  </body>
  <footer>
    <div id="footer">
      <div class="w3-container w3-padding-small">
        <center><button onclick="toggleTheme()">Toggle dark mode</button></center>
      </div>
      <div class="w3-container w3-padding-small">
        <center>LNDg v1.6.0</center>
      </div>
    </div>
  </footer>
  <script>
    document.onkeypress = function (e) {
      if(e.ctrlKey && e.shiftKey && e.charCode == 5) document.body.classList.toggle("encrypted")
      document.cookie = `encrypt=${document.body.classList.contains("encrypted")}`
    };
    document.addEventListener('DOMContentLoaded', async () => {
      if (document.cookie.includes("encrypt=true")) document.body.classList.toggle("encrypted")
      let divMsgs = document.getElementById("messages")
      if (divMsgs ^ divMsgs.children[1]?.src?.length > 0) return 

      [...divMsgs.children].forEach(el => el.classList.toggle('message'))
      await new Promise(r => setTimeout(r, 4000))
      divMsgs?.remove()
    })
  </script>
</html>
